---

title: Integration test on Wikitext-2
keywords: fastai
sidebar: home_sidebar

summary: "Training a Language Model on WT2"
---
<!--


#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: dev/35_tutorial_wikitext.ipynb
# instructions: https://docs.fast.ai/gen_doc_main.html

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">local.imports</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">local.test</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">local.core</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">local.layers</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">local.data.all</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">local.notebook.showdoc</span> <span class="k">import</span> <span class="n">show_doc</span>
<span class="kn">from</span> <span class="nn">local.optimizer</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">local.learner</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">local.metrics</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">local.text.data</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">local.text.models.core</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">local.text.models.awdlstm</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">local.callback.rnn</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">local.callback.all</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">decompress_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">WIKITEXT_TINY</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The dataset comes with all the wrticles concatenated. We split them to be able to shuffle at the beginning of each epoch.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">istitle</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^ = [^=]* = $&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">articles</span> <span class="o">=</span> <span class="n">L</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">current_article</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="n">current_article</span> <span class="o">+=</span> <span class="n">line</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">and</span> <span class="n">istitle</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">articles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_article</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
            <span class="n">current_article</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">articles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_article</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">articles</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we put our list of tokenized texts together in an <a href="/text.data.html#LM_Dataset"><code>LM_Dataset</code></a>. It will return tuples of sequences of <code>seq_len</code>, with the second sequence between the first one shifted by one on the right.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs</span><span class="p">,</span><span class="n">sl</span> <span class="o">=</span> <span class="mi">104</span><span class="p">,</span><span class="mi">72</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">LM_Dataset</span><span class="p">(</span><span class="n">read_file</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;train.txt&#39;</span><span class="p">),</span> <span class="n">bs</span><span class="o">=</span><span class="n">bs</span><span class="p">,</span> <span class="n">seq_len</span><span class="o">=</span><span class="n">sl</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">valid</span> <span class="o">=</span> <span class="n">LM_Dataset</span><span class="p">(</span><span class="n">read_file</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;valid.txt&#39;</span><span class="p">),</span> <span class="n">bs</span><span class="o">=</span><span class="n">bs</span><span class="p">,</span> <span class="n">seq_len</span><span class="o">=</span><span class="n">sl</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>([&#39;&#39;, &#39;\n&#39;, &#39;=&#39;, &#39;Geopyxis&#39;, &#39;carbonaria&#39;, &#39;=&#39;, &#39;\n&#39;, &#39;\n&#39;, &#39;Geopyxis&#39;, &#39;carbonaria&#39;, &#39;is&#39;, &#39;a&#39;, &#39;species&#39;, &#39;of&#39;, &#39;fungus&#39;, &#39;in&#39;, &#39;the&#39;, &#39;genus&#39;, &#39;Geopyxis&#39;, &#39;,&#39;, &#39;family&#39;, &#39;&lt;unk&gt;&#39;, &#39;.&#39;, &#39;First&#39;, &#39;described&#39;, &#39;to&#39;, &#39;science&#39;, &#39;in&#39;, &#39;1805&#39;, &#39;,&#39;, &#39;and&#39;, &#39;given&#39;, &#39;its&#39;, &#39;current&#39;, &#39;name&#39;, &#39;in&#39;, &#39;1889&#39;, &#39;,&#39;, &#39;the&#39;, &#39;species&#39;, &#39;is&#39;, &#39;commonly&#39;, &#39;known&#39;, &#39;as&#39;, &#39;the&#39;, &#39;charcoal&#39;, &#39;loving&#39;, &#39;elf&#39;, &#39;@-@&#39;, &#39;cup&#39;, &#39;,&#39;, &#39;dwarf&#39;, &#39;&lt;unk&gt;&#39;, &#39;cup&#39;, &#39;,&#39;, &#39;&lt;unk&gt;&#39;, &#39;&lt;unk&gt;&#39;, &#39;cup&#39;, &#39;,&#39;, &#39;or&#39;, &#39;pixie&#39;, &#39;cup&#39;, &#39;.&#39;, &#39;The&#39;, &#39;small&#39;, &#39;,&#39;, &#39;&lt;unk&gt;&#39;, &#39;@-@&#39;, &#39;shaped&#39;, &#39;fruitbodies&#39;, &#39;of&#39;, &#39;the&#39;], [&#39;\n&#39;, &#39;=&#39;, &#39;Geopyxis&#39;, &#39;carbonaria&#39;, &#39;=&#39;, &#39;\n&#39;, &#39;\n&#39;, &#39;Geopyxis&#39;, &#39;carbonaria&#39;, &#39;is&#39;, &#39;a&#39;, &#39;species&#39;, &#39;of&#39;, &#39;fungus&#39;, &#39;in&#39;, &#39;the&#39;, &#39;genus&#39;, &#39;Geopyxis&#39;, &#39;,&#39;, &#39;family&#39;, &#39;&lt;unk&gt;&#39;, &#39;.&#39;, &#39;First&#39;, &#39;described&#39;, &#39;to&#39;, &#39;science&#39;, &#39;in&#39;, &#39;1805&#39;, &#39;,&#39;, &#39;and&#39;, &#39;given&#39;, &#39;its&#39;, &#39;current&#39;, &#39;name&#39;, &#39;in&#39;, &#39;1889&#39;, &#39;,&#39;, &#39;the&#39;, &#39;species&#39;, &#39;is&#39;, &#39;commonly&#39;, &#39;known&#39;, &#39;as&#39;, &#39;the&#39;, &#39;charcoal&#39;, &#39;loving&#39;, &#39;elf&#39;, &#39;@-@&#39;, &#39;cup&#39;, &#39;,&#39;, &#39;dwarf&#39;, &#39;&lt;unk&gt;&#39;, &#39;cup&#39;, &#39;,&#39;, &#39;&lt;unk&gt;&#39;, &#39;&lt;unk&gt;&#39;, &#39;cup&#39;, &#39;,&#39;, &#39;or&#39;, &#39;pixie&#39;, &#39;cup&#39;, &#39;.&#39;, &#39;The&#39;, &#39;small&#39;, &#39;,&#39;, &#39;&lt;unk&gt;&#39;, &#39;@-@&#39;, &#39;shaped&#39;, &#39;fruitbodies&#39;, &#39;of&#39;, &#39;the&#39;, &#39;fungus&#39;])
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can then wrap our <a href="/text.data.html#LM_Dataset"><code>LM_Dataset</code></a>s in a <a href="/pipeline.html#TfmdList"><code>TfmdList</code></a> to apply the <a href="/text.data.html#Numericalize"><code>Numericalize</code></a> transform. We can't use a <a href="/pipeline.html#TfmdDS"><code>TfmdDS</code></a> because our elements are already tuples and <a href="/pipeline.html#TfmdDS"><code>TfmdDS</code></a> is there to create such tuples from individual items. Since we already have tuples, we specify <code>as_item=False</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">train</span><span class="o">.</span><span class="n">ds</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">t</span><span class="p">])</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="n">make_vocab</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
<span class="n">train_ds</span> <span class="o">=</span> <span class="n">TfmdList</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">tfms</span><span class="o">=</span><span class="n">Numericalize</span><span class="p">(</span><span class="n">vocab</span><span class="p">),</span> <span class="n">as_item</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wrap_l</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">valid_ds</span> <span class="o">=</span> <span class="n">TfmdList</span><span class="p">(</span><span class="n">valid</span><span class="p">,</span> <span class="n">tfms</span><span class="o">=</span><span class="n">Numericalize</span><span class="p">(</span><span class="n">vocab</span><span class="p">),</span> <span class="n">as_item</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wrap_l</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Last but not least, we need to use a special sampler that will make sure we ask for the correct sequences to form a batch: in the first batch we don't want the sequences 0,1,2,3... (they are contiguous in the source obtained by concatenating all texts) but the sequences 0,<code>num_batches</code>,<code>2*num_batches</code>,...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_dl</span> <span class="o">=</span> <span class="n">TfmdDL</span><span class="p">(</span><span class="n">train_ds</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="n">bs</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">LM_Sampler</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">tfms</span><span class="o">=</span><span class="n">Cuda</span><span class="p">(),</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">valid_dl</span> <span class="o">=</span> <span class="n">TfmdDL</span><span class="p">(</span><span class="n">valid_ds</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="n">bs</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">LM_Sampler</span><span class="p">(</span><span class="n">valid</span><span class="p">),</span> <span class="n">tfms</span><span class="o">=</span><span class="n">Cuda</span><span class="p">(),</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dbch</span> <span class="o">=</span> <span class="n">DataBunch</span><span class="p">(</span><span class="n">train_dl</span><span class="p">,</span> <span class="n">valid_dl</span><span class="p">)</span>
<span class="n">dbch</span><span class="o">.</span><span class="n">show_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>index</th>
      <th>text</th>
      <th>text_</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>\n = Geopyxis carbonaria = \n \n Geopyxis carbonaria is a species of fungus in the genus Geopyxis , family &lt;unk&gt; . First described to science in 1805 , and given its current name in 1889 , the species is commonly known as the charcoal loving elf @-@ cup , dwarf &lt;unk&gt; cup , &lt;unk&gt; &lt;unk&gt; cup , or pixie cup . The small , &lt;unk&gt; @-@ shaped fruitbodies of the</td>
      <td>\n = Geopyxis carbonaria = \n \n Geopyxis carbonaria is a species of fungus in the genus Geopyxis , family &lt;unk&gt; . First described to science in 1805 , and given its current name in 1889 , the species is commonly known as the charcoal loving elf @-@ cup , dwarf &lt;unk&gt; cup , &lt;unk&gt; &lt;unk&gt; cup , or pixie cup . The small , &lt;unk&gt; @-@ shaped fruitbodies of the fungus</td>
    </tr>
    <tr>
      <td>1</td>
      <td>Creek is in a sandstone and shale mountain region , it has a relatively low capacity to neutralize added acid . This makes it especially vulnerable to increased &lt;unk&gt; from acid rain , which poses a threat to the long term health of the plants and animals in the creek . The total &lt;unk&gt; ( TA ) is a measure of the capacity of water to neutralize acid , with a larger</td>
      <td>is in a sandstone and shale mountain region , it has a relatively low capacity to neutralize added acid . This makes it especially vulnerable to increased &lt;unk&gt; from acid rain , which poses a threat to the long term health of the plants and animals in the creek . The total &lt;unk&gt; ( TA ) is a measure of the capacity of water to neutralize acid , with a larger TA</td>
    </tr>
    <tr>
      <td>2</td>
      <td>the homes of wealthy Jews . \n Finally her soliciting paid off and in 1881 , Rosebery was offered a government position acceptable to him , that of Under Secretary at the Home Office with special responsibility for Scotland . He had sought the position feeling that Scotland was neglected by the Liberal Government who were more interested in Ireland . However , immediately upon assuming the job he began to demand</td>
      <td>homes of wealthy Jews . \n Finally her soliciting paid off and in 1881 , Rosebery was offered a government position acceptable to him , that of Under Secretary at the Home Office with special responsibility for Scotland . He had sought the position feeling that Scotland was neglected by the Liberal Government who were more interested in Ireland . However , immediately upon assuming the job he began to demand a</td>
    </tr>
    <tr>
      <td>3</td>
      <td>and Sweden , and the Danish and Swedish governments threatened to terminate the SAS agreement . On 25 November 1966 , with 82 against 62 votes , the Norwegian Parliament voted to allow Braathens SAFE to fly to Bodø and Tromsø as an extension of the West Coast route from 1 April 1967 . \n On 3 March 1967 , parliament decided to build four short take @-@ off and landing airports</td>
      <td>Sweden , and the Danish and Swedish governments threatened to terminate the SAS agreement . On 25 November 1966 , with 82 against 62 votes , the Norwegian Parliament voted to allow Braathens SAFE to fly to Bodø and Tromsø as an extension of the West Coast route from 1 April 1967 . \n On 3 March 1967 , parliament decided to build four short take @-@ off and landing airports along</td>
    </tr>
    <tr>
      <td>4</td>
      <td>the outfitting center for Colorado gold &lt;unk&gt; headed for &lt;unk&gt; Peak in 1859 , 268 steamboats arrived at Omaha between March and November . \n With railroads becoming the dominant form of long @-@ range shipping and passenger travel in the early 1870s , &lt;unk&gt; like those in Omaha became obsolete . However , as late at 1949 the steamship Avalon was letting passengers in Omaha , before becoming one of the</td>
      <td>outfitting center for Colorado gold &lt;unk&gt; headed for &lt;unk&gt; Peak in 1859 , 268 steamboats arrived at Omaha between March and November . \n With railroads becoming the dominant form of long @-@ range shipping and passenger travel in the early 1870s , &lt;unk&gt; like those in Omaha became obsolete . However , as late at 1949 the steamship Avalon was letting passengers in Omaha , before becoming one of the famous</td>
    </tr>
    <tr>
      <td>5</td>
      <td>of February 2016 , Vistara has a share of 2 % in the domestic carrier market . \n \n = = Corporate affairs = = \n \n In March 2015 , Vistara shifted to its new office at the One Horizon Center tower in Sector 43 , &lt;unk&gt; , a satellite city of Delhi . Vistara chose &lt;unk&gt; &lt;unk&gt; Yeoh as the chief executive officer ( CEO ) and &lt;unk&gt; Ming &lt;unk&gt;</td>
      <td>February 2016 , Vistara has a share of 2 % in the domestic carrier market . \n \n = = Corporate affairs = = \n \n In March 2015 , Vistara shifted to its new office at the One Horizon Center tower in Sector 43 , &lt;unk&gt; , a satellite city of Delhi . Vistara chose &lt;unk&gt; &lt;unk&gt; Yeoh as the chief executive officer ( CEO ) and &lt;unk&gt; Ming &lt;unk&gt; as</td>
    </tr>
    <tr>
      <td>6</td>
      <td>the &lt;unk&gt; of the Indian National Congress and is still a major newspaper of Hindi northern India . \n \n = = = Art = = = \n \n Varanasi is a major centre of arts and designs . It is a producer of &lt;unk&gt; and &lt;unk&gt; with gold and silver thread work , carpet weaving , wooden toys , &lt;unk&gt; made of glass , ivory work , perfumes , artistic brass</td>
      <td>&lt;unk&gt; of the Indian National Congress and is still a major newspaper of Hindi northern India . \n \n = = = Art = = = \n \n Varanasi is a major centre of arts and designs . It is a producer of &lt;unk&gt; and &lt;unk&gt; with gold and silver thread work , carpet weaving , wooden toys , &lt;unk&gt; made of glass , ivory work , perfumes , artistic brass and</td>
    </tr>
    <tr>
      <td>7</td>
      <td>of war under your charge to the State authorities , to be held subject to the action of the convention to be held on the 4th of March next . \n Perhaps because Abraham Lincoln had not yet been inaugurated as President , Captain Totten received no instructions from his superiors and was forced to withdraw his troops . He agreed to surrender the arsenal as long as the governor agreed to</td>
      <td>war under your charge to the State authorities , to be held subject to the action of the convention to be held on the 4th of March next . \n Perhaps because Abraham Lincoln had not yet been inaugurated as President , Captain Totten received no instructions from his superiors and was forced to withdraw his troops . He agreed to surrender the arsenal as long as the governor agreed to three</td>
    </tr>
    <tr>
      <td>8</td>
      <td>the home . The decision to use a stay @-@ at @-@ home dad arrangement is most commonly due to economic reasons . At the same time , women are progressing into higher @-@ paying jobs . There are now financial ramifications in deciding whether the mother or father should become the stay @-@ at @-@ home parent . In cases where the woman is the higher @-@ paid parent , it</td>
      <td>home . The decision to use a stay @-@ at @-@ home dad arrangement is most commonly due to economic reasons . At the same time , women are progressing into higher @-@ paying jobs . There are now financial ramifications in deciding whether the mother or father should become the stay @-@ at @-@ home parent . In cases where the woman is the higher @-@ paid parent , it makes</td>
    </tr>
    <tr>
      <td>9</td>
      <td>Allosaurus itself or at least the species A. fragillis , is technically a nomen dubium ( " dubious name " , based on a specimen too incomplete to compare to other specimens or to classify ) . In an attempt to fix this situation , Gregory S. Paul and Kenneth Carpenter ( 2010 ) submitted a petition to the &lt;unk&gt; to have the name A. fragillis officially transferred to the more complete</td>
      <td>itself or at least the species A. fragillis , is technically a nomen dubium ( " dubious name " , based on a specimen too incomplete to compare to other specimens or to classify ) . In an attempt to fix this situation , Gregory S. Paul and Kenneth Carpenter ( 2010 ) submitted a petition to the &lt;unk&gt; to have the name A. fragillis officially transferred to the more complete specimen</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">awd_lstm_lm_config</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;input_p&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span> <span class="s1">&#39;output_p&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;weight_p&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;embed_p&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;hidden_p&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">})</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">get_language_model</span><span class="p">(</span><span class="n">AWD_LSTM</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">),</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">opt_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">Adam</span><span class="p">,</span> <span class="n">wd</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">)</span>
<span class="n">cb_funcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">partial</span><span class="p">(</span><span class="n">MixedPrecision</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">partial</span><span class="p">(</span><span class="n">RNNTrainer</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dbch</span><span class="p">,</span> <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(),</span> <span class="n">opt_func</span><span class="o">=</span><span class="n">opt_func</span><span class="p">,</span> <span class="n">cb_funcs</span><span class="o">=</span><span class="n">cb_funcs</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">Perplexity</span><span class="p">()])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">prun</span> learn.fit_one_cycle(1, 5e-3, moms=(0.8,0.7,0.8), div=10)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>perplexity</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>5.557487</td>
      <td>5.043018</td>
      <td>0.244405</td>
      <td>154.936890</td>
      <td>01:52</td>
    </tr>
  </tbody>
</table>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre> </pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

